<!DOCTYPE html>
<html lang="en-us">
<head>
	<script type="module" crossorigin src="js/google-analytics.js"></script>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>MotoDEX NFT game | {{{ PRODUCT_NAME }}}</title>
	<link rel="shortcut icon" href="TemplateData/favicon.ico">
	<link rel="stylesheet" href="TemplateData/style.css">
	<script type="module" crossorigin src="web3/index.js"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;800&display=swap" rel="stylesheet">
</head>
<body>
<div id="custom-logo" hidden></div>
<div id="custom-loader" hidden>
	<div class="fill"></div>
	<div id="custom-bar">
		<div class="progressBar"></div>
	</div>
	<div class="progressLabel">
		<tr>0%</tr>
	</div>
</div>
<div id="alert-custom-logo" hidden>
	<div class="alert-custom-img"></div>
	<div class="alert-custom-text">
		<span>Experience our captivating web game, now available on desktop! Explore a world of adventure, strategy, and endless fun. Don't miss out on the excitement - <br><b>Play Now!</b></span>
	</div>
	<div class="alert-custom-button" id="buyButton">
		<span>BUY</span>
	</div>
</div>
<div class="webgl-content" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden;">
	<div id="unity-container" class="unity-desktop">
		<canvas id="unity-canvas" width={{{ WIDTH }}} height={{{ HEIGHT }}}></canvas>
		<div id="unity-loading-bar">
			<div id="unity-logo"></div>
			<div id="unity-progress-bar-empty">
				<div id="unity-progress-bar-full"></div>
			</div>
		</div>
		<div id="unity-warning"> </div>
		<div id="unity-footer">
			<div id="unity-webgl-logo"></div>
			<div id="unity-fullscreen-button"></div>
		</div>
	</div>
</div>
<script>
	document.body.appendChild(Object.assign(document.createElement("script"), { type: "text/javascript", src: "./network.js" }));
</script>

<script>
	function checkBrowser() {
		const userAgent = navigator.userAgent;
		let browserName;

		const browsers = [
			{ name: "Edge", pattern: "Edg" },
			{ name: "Opera", pattern: "OPR" },
			{ name: "Vivaldi", pattern: "Vivaldi" },
			{ name: "Yandex", pattern: "YaBrowser" },
			{ name: "Google Chrome", pattern: "Chrome" },
			{ name: "Google Chrome on iOS", pattern: "CriOS" },
			{ name: "Firefox", pattern: "Firefox" },
			{ name: "Safari", pattern: "Safari" },
			{ name: "Internet Explorer", pattern: "MSIE" },
			{ name: "Internet Explorer", pattern: "Trident" },
			{ name: "Samsung Internet", pattern: "SamsungBrowser" },
			{ name: "Brave", pattern: "Brave" },
			{ name: "UC Browser", pattern: "UCBrowser" },
			{ name: "DuckDuckGo", pattern: "DuckDuckGo" }
		];

		for (const browser of browsers) {
			if (userAgent.indexOf(browser.pattern) > -1) {
				browserName = browser.name;
				break;
			}
		}

		if (browserName === "Google Chrome" || browserName === "Google Chrome on iOS")
		{
			return true;
		}
		else 
		{
			alert("Please open this application in Google Chrome for the best experience" + "\nYou are using: " + browserName);
			return false;
		}
	}




	if (checkBrowser()) {
		var container = document.querySelector("#unity-container");
		var canvas = document.querySelector("#unity-canvas");
		var loadingBar = document.querySelector("#custom-loader");
		var customLogo = document.querySelector("#custom-logo");
		var mobileLogo = document.querySelector("#alert-custom-logo");
		var fullscreenButton = document.querySelector("#unity-fullscreen-button");
		var warningBanner = document.querySelector("#unity-warning");

		function unityShowBanner(msg, type) {
			function updateBannerVisibility() {
				warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
			}
			var div = document.createElement('div');
			div.innerHTML = msg;
			warningBanner.appendChild(div);
			if (type == 'error') div.style = 'background: red; padding: 10px;';
			else {
				if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
				setTimeout(function() {
					warningBanner.removeChild(div);
					updateBannerVisibility();
				}, 5000);
			}
			updateBannerVisibility();
		}

		function setLoaderProgressTo(value) {
			const fill = loadingBar.getElementsByClassName("progressBar")[0];
			const fillText = loadingBar.getElementsByClassName("progressLabel")[0];

			fill.animate(
					[
						{ width: (value * 100) + "%" }
					],
					{
						duration: 300,
						fill: "forwards"
					}
			);

			fillText.textContent = (value * 100).toFixed() + "%";
		}

		var buildUrl = "Build";
		var loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
		var config = {
			dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
			frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
			codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
			memoryUrl: buildUrl + "/{{{ MEMORY_FILENAME }}}",
			symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}",
			streamingAssetsUrl: "StreamingAssets",
			companyName: "{{{ COMPANY_NAME }}}",
			productName: "{{{ PRODUCT_NAME }}}",
			productVersion: "{{{ PRODUCT_VERSION }}}",
			showBanner: unityShowBanner,
		};

		customLogo.style.display = "block";
		container.appendChild(customLogo);
		loadingBar.style.display = "block";
		container.appendChild(loadingBar);

		var script = document.createElement("script");
		script.src = loaderUrl;
		script.onload = () => {
			createUnityInstance(canvas, config, (progress) => {
				setLoaderProgressTo(progress);
			}).then((unityInstance) => {
				loadingBar.style.display = "none";
				customLogo.style.display = "none";
				fullscreenButton.onclick = () => {
					unityInstance.SetFullscreen(1);
				};
			}).catch((message) => {
				alert(message);
			});
		};
		document.body.appendChild(script);
	} else {
		// Prevent loading the Unity game
		document.querySelector(".webgl-content").style.display = "none";
	}
</script>

<script type="text/javascript">
	var container = document.querySelector("#unity-container");
	var canvas = document.querySelector("#unity-canvas");

	var resize = function() {
		canvas.style.width = window.innerWidth + "px";
		canvas.style.height = window.innerHeight + "px";
	};

	resize();
	window.addEventListener("resize", resize);
</script>

</body>
</html>
